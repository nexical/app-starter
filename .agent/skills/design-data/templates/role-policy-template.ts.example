import { RolePolicy } from ' @/lib/registries/role-registry';
import type { APIContext, AstroGlobal } from 'astro';

/**
 * Role Policy for granular access control (RBAC/ABAC).
 * 
 * Policies are auto-discovered if placed in the src/roles/ directory
 * and registered in server-init.ts.
 * 
 * Location: modules/{{kebab-case-module-name}}/src/roles/{{kebab-case-name}}.ts
 */
export class {{PascalCaseName}}Policy implements RolePolicy {
  /**
   * The check method is called by ApiGuard.protect() or manual checks.
   * Throw an error to deny access.
   */
  async check(context: APIContext | AstroGlobal, input?: any) {
    const actor = (context as APIContext).locals?.actor;

    if (!actor) {
      throw new Error('Unauthorized: No actor context found');
    }

    // Example: ABAC (Attribute-Based Access Control)
    // if (input?.ownerId && actor.id !== input.ownerId) {
    //   throw new Error('Forbidden: You do not own this resource');
    // }

    // Example: RBAC (Role-Based Access Control)
    // if (actor.role !== 'ADMIN') {
    //   throw new Error('Forbidden: Admin role required');
    // }
  }
}
